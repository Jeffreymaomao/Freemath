(()=>{"use strict";var t={710:(t,e,n)=>{n.d(e,{A:()=>g});var i=n(601),o=n.n(i),a=n(314),r=n.n(a),s=n(417),m=n.n(s),d=new URL(n(361),n.b),l=new URL(n(445),n.b),h=new URL(n(653),n.b),c=r()(o()),p=m()(d),f=m()(l),u=m()(h);c.push([t.id,`@font-face {\n    font-family: 'LatinModernRoman';\n    src: url(${p}) format("opentype");\n    unicode-range: U+0020-007F, /* Basic Latin */\n                   U+2200-22FF, /* Mathematical Operators */\n                   U+2A00-2AFF, /* Supplemental Mathematical Operators */\n                   U+27C0-27EF; /* Miscellaneous Mathematical Symbols-A */\n   font-display: swap;\n}\n\n@font-face {\n    font-family: 'BiauKai';\n    src: local('標楷體'),\n         url(${f}) format('woff'),\n         url(${u}) format('woff2');\n    unicode-range: U+4E00-9FFF;\n    font-display: swap;\n}\n\n/* ---- */\n\n.mathnote-container {\n    display: block;\n    width: 100%;\n/*    height: 100%;*/\n    border-style: solid;\n    border-color: gray;\n    border-width: 0.5px 0px;\n}\n\n.mathnote-matheq {\n    border-color: gray;\n    border-style: solid;\n    border-width: 0.5px 1px;\n}\n\n.mathnote-matheq.textmode textarea.mathnote-text-textarea {\n    border-width: 1px;\n    width: 100%;\n    overflow: hidden;\n    resize: none;\n    vertical-align: middle;\n    font-family: 'BiauKai', 'LatinModernRoman', 'Symbola',\n                 'Times New Roman', 'Times', serif;  \n    font-size: 1.15em;\n    border: none;\n    white-space: nowrap;\n}\n\n.mathnote-matheq.textmode .mathnote-text-textarea:focus{\n    outline: none;\n}\n\n.mathnote-matheq.focus,\n.mq-editable-field.mq-focused,\n.mq-math-mode .mq-editable-field.mq-focused {\n    box-shadow: none;\n    border-style: solid;\n    border-radius: 0px;\n    border-color: #6a93d2;\n    border-width: 1px 1px;\n\n    box-shadow: 0 0 2px #6a93d2,\n                0 0 2px #6a93d2;\n}\n\n.mathnote-matheq.focus {\n    box-shadow: 0 0 2px #d26a93,\n                0 0 2px #d26a93;\n    border-color: #d26a93;\n}\n\n.mathnote-matheq {\n    padding: 0px;\n}\n\n.mq-math-mode .mq-root-block {\n    padding: 15px;\n    overflow: hidden;\n}\n\n.mathnote-matheq.textmode textarea.mathnote-text-textarea {\n    padding: 14px 15px;\n}\n\n/* --- */\n\n.mathnote-matheq {\n    padding-right: 35px;\n}\n\n.mathnote-label {\n    position: absolute;\n    padding-right: 2px;\n    right: 0;\n    top: 50%;\n    transform: translate(0, -50%);\n    text-align: middle;\n}\n\n/* --- */\n\n.mq-editable-field,\n.mq-root-block,\n.mq-math-mode,\n.mq-math-mode .mq-root-block {\n    display: block;\n}\n\n/* --- */\n.mq-math-mode big {\n    font-size: 200%;\n}\n\n.mq-math-mode .mq-large-operator {\n    vertical-align: -0.3em;\n    padding: 0.2em;\n}\n\n.mq-math-mode .mq-sub {\n    font-size: 80%;\n    margin-right: 1px;\n}\n\n.mq-math-mode .mq-fraction {\n    font-size: 100%;\n}\n\n.mq-math-mode .mq-text-mode {\n    font-size: 100%;\n}\n\n.mq-editable-field .mq-latex-command-input {\n    border: 0.1px solid gray;\n}\n\n/* --- */\n\n.mq-math-mode .mq-selection,\n.mq-editable-field .mq-selection,\n.mq-math-mode .mq-selection .mq-non-leaf,\n.mq-editable-field .mq-selection .mq-non-leaf,\n.mq-math-mode .mq-selection .mq-scaled,\n.mq-editable-field .mq-selection .mq-scaled {\n    background: #B4D5FE !important;\n    color: HighlightText;\n    border-color: HighlightText;\n}\n\n`,""]);const g=c},699:(t,e,n)=>{n.d(e,{A:()=>v});var i=n(601),o=n.n(i),a=n(314),r=n.n(a),s=n(417),m=n.n(s),d=new URL(n(989),n.b),l=new URL(n(349),n.b),h=new URL(n(45),n.b),c=new URL(n(599),n.b),p=new URL(n(316),n.b),f=new URL(n(999),n.b),u=r()(o()),g=m()(d),b=m()(l),q=m()(h),y=m()(c),x=m()(p),w=m()(f,{hash:"#Symbola"});u.push([t.id,`/*\n * MathQuill v0.10.1               http://mathquill.com\n * by Han, Jeanine, and Mary  maintainers@mathquill.com\n *\n * This Source Code Form is subject to the terms of the\n * Mozilla Public License, v. 2.0. If a copy of the MPL\n * was not distributed with this file, You can obtain\n * one at http://mozilla.org/MPL/2.0/.\n */\n@font-face {\n    font-family: Symbola;\n    src: url(${g});\n    src: local("Symbola Regular"), local("Symbola"),\n         url(${b}) format("woff2"),\n         url(${q}) format("woff"),\n         url(${y}) format("truetype"),\n         url(${x}) format("opentype"),\n         url(${w}) format("svg");\n    font-display: swap;\n}\n\n/*** The following is original.***\n@font-face {\n    font-family: Symbola;\n    src: url(font/Symbola.eot);\n    src: local("Symbola Regular"), local("Symbola"), url(font/Symbola.woff2) format("woff2"), url(font/Symbola.woff) format("woff"), url(font/Symbola.ttf) format("truetype"), url(font/Symbola.otf) format("opentype"), url(font/Symbola.svg#Symbola) format("svg");\n}\n***********************************/\n\n.mq-editable-field {\n    display: -moz-inline-box;\n    display: inline-block;\n}\n\n.mq-editable-field .mq-cursor {\n    border-left: 1px solid black;\n    margin-left: -1px;\n    position: relative;\n    z-index: 1;\n    padding: 0;\n    display: -moz-inline-box;\n    display: inline-block;\n}\n\n.mq-editable-field .mq-cursor.mq-blink {\n    visibility: hidden;\n}\n\n.mq-editable-field,\n.mq-math-mode .mq-editable-field {\n    border: 1px solid gray;\n}\n\n.mq-editable-field.mq-focused,\n.mq-math-mode .mq-editable-field.mq-focused {\n    -webkit-box-shadow: #8bd 0 0 1px 2px, inset #6ae 0 0 2px 0;\n    -moz-box-shadow: #8bd 0 0 1px 2px, inset #6ae 0 0 2px 0;\n    box-shadow: #8bd 0 0 1px 2px, inset #6ae 0 0 2px 0;\n    border-color: #709AC0;\n    border-radius: 1px;\n}\n\n.mq-math-mode .mq-editable-field {\n    margin: 1px;\n}\n\n.mq-editable-field .mq-latex-command-input {\n    color: inherit;\n    font-family: "Courier New", monospace;\n    border: 1px solid gray;\n    padding-right: 1px;\n    margin-right: 1px;\n    margin-left: 2px;\n}\n\n.mq-editable-field .mq-latex-command-input.mq-empty {\n    background: transparent;\n}\n\n.mq-editable-field .mq-latex-command-input.mq-hasCursor {\n    border-color: ActiveBorder;\n}\n\n.mq-editable-field.mq-empty:after,\n.mq-editable-field.mq-text-mode:after,\n.mq-math-mode .mq-empty:after {\n    visibility: hidden;\n    content: 'c';\n}\n\n.mq-editable-field .mq-cursor:only-child:after,\n.mq-editable-field .mq-textarea+.mq-cursor:last-child:after {\n    visibility: hidden;\n    content: 'c';\n}\n\n.mq-editable-field .mq-text-mode .mq-cursor:only-child:after {\n    content: '';\n}\n\n.mq-editable-field.mq-text-mode {\n    overflow-x: auto;\n    overflow-y: hidden;\n}\n\n.mq-root-block,\n.mq-math-mode .mq-root-block {\n    display: -moz-inline-box;\n    display: inline-block;\n    width: 100%;\n    padding: 2px;\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n    white-space: nowrap;\n    overflow: hidden;\n    vertical-align: middle;\n}\n\n.mq-math-mode {\n    font-variant: normal;\n    font-weight: normal;\n    font-style: normal;\n    font-size: 115%;\n    line-height: 1;\n    display: -moz-inline-box;\n    display: inline-block;\n}\n\n.mq-math-mode .mq-non-leaf,\n.mq-math-mode .mq-scaled {\n    display: -moz-inline-box;\n    display: inline-block;\n}\n\n.mq-math-mode var,\n.mq-math-mode .mq-text-mode,\n.mq-math-mode .mq-nonSymbola {\n    font-family: "Times New Roman", Symbola, serif;\n    line-height: .9;\n}\n\n.mq-math-mode * {\n    font-size: inherit;\n    line-height: inherit;\n    margin: 0;\n    padding: 0;\n    border-color: black;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n    box-sizing: border-box;\n}\n\n.mq-math-mode .mq-empty {\n    background: #ccc;\n}\n\n.mq-math-mode .mq-empty.mq-root-block {\n    background: transparent;\n}\n\n.mq-math-mode.mq-empty {\n    background: transparent;\n}\n\n.mq-math-mode .mq-text-mode {\n    font-size: 87%;\n}\n\n.mq-math-mode .mq-font {\n    font: 1em "Times New Roman", Symbola, serif;\n}\n\n.mq-math-mode .mq-font * {\n    font-family: inherit;\n    font-style: inherit;\n}\n\n.mq-math-mode b,\n.mq-math-mode b.mq-font {\n    font-weight: bolder;\n}\n\n.mq-math-mode var,\n.mq-math-mode i,\n.mq-math-mode i.mq-font {\n    font-style: italic;\n}\n\n.mq-math-mode var.mq-f {\n    margin-right: 0.2em;\n    margin-left: 0.1em;\n}\n\n.mq-math-mode .mq-roman var.mq-f {\n    margin: 0;\n}\n\n.mq-math-mode big {\n    font-size: 125%;\n}\n\n.mq-math-mode .mq-roman {\n    font-style: normal;\n}\n\n.mq-math-mode .mq-sans-serif {\n    font-family: sans-serif, Symbola, serif;\n}\n\n.mq-math-mode .mq-monospace {\n    font-family: monospace, Symbola, serif;\n}\n\n.mq-math-mode .mq-overline {\n    border-top: 1px solid black;\n    margin-top: 1px;\n}\n\n.mq-math-mode .mq-underline {\n    border-bottom: 1px solid black;\n    margin-bottom: 1px;\n}\n\n.mq-math-mode .mq-binary-operator {\n    padding: 0 0.2em;\n    display: -moz-inline-box;\n    display: inline-block;\n}\n\n.mq-math-mode .mq-supsub {\n    font-size: 90%;\n    vertical-align: -0.5em;\n}\n\n.mq-math-mode .mq-supsub.mq-limit {\n    font-size: 80%;\n    vertical-align: -0.4em;\n}\n\n.mq-math-mode .mq-supsub.mq-sup-only {\n    vertical-align: .5em;\n}\n\n.mq-math-mode .mq-supsub.mq-sup-only .mq-sup {\n    display: inline-block;\n    vertical-align: text-bottom;\n}\n\n.mq-math-mode .mq-supsub .mq-sup {\n    display: block;\n}\n\n.mq-math-mode .mq-supsub .mq-sub {\n    display: block;\n    float: left;\n}\n\n.mq-math-mode .mq-supsub.mq-limit .mq-sub {\n    margin-left: -0.25em;\n}\n\n.mq-math-mode .mq-supsub .mq-binary-operator {\n    padding: 0 .1em;\n}\n\n.mq-math-mode .mq-supsub .mq-fraction {\n    font-size: 70%;\n}\n\n.mq-math-mode sup.mq-nthroot {\n    font-size: 80%;\n    vertical-align: 0.8em;\n    margin-right: -0.6em;\n    margin-left: .2em;\n    min-width: .5em;\n}\n\n.mq-math-mode .mq-paren {\n    padding: 0 .1em;\n    vertical-align: top;\n    -webkit-transform-origin: center .06em;\n    -moz-transform-origin: center .06em;\n    -ms-transform-origin: center .06em;\n    -o-transform-origin: center .06em;\n    transform-origin: center .06em;\n}\n\n.mq-math-mode .mq-paren.mq-ghost {\n    color: silver;\n}\n\n.mq-math-mode .mq-paren+span {\n    margin-top: .1em;\n    margin-bottom: .1em;\n}\n\n.mq-math-mode .mq-array {\n    vertical-align: middle;\n    text-align: center;\n}\n\n.mq-math-mode .mq-array>span {\n    display: block;\n}\n\n.mq-math-mode .mq-operator-name {\n    font-family: Symbola, "Times New Roman", serif;\n    line-height: .9;\n    font-style: normal;\n}\n\n.mq-math-mode var.mq-operator-name.mq-first {\n    padding-left: .2em;\n}\n\n.mq-math-mode var.mq-operator-name.mq-last {\n    padding-right: .2em;\n}\n\n.mq-math-mode .mq-fraction {\n    font-size: 90%;\n    text-align: center;\n    vertical-align: -0.4em;\n    padding: 0 .2em;\n}\n\n.mq-math-mode .mq-fraction,\n.mq-math-mode .mq-large-operator,\n.mq-math-mode x:-moz-any-link {\n    display: -moz-groupbox;\n}\n\n.mq-math-mode .mq-fraction,\n.mq-math-mode .mq-large-operator,\n.mq-math-mode x:-moz-any-link,\n.mq-math-mode x:default {\n    display: inline-block;\n}\n\n.mq-math-mode .mq-numerator,\n.mq-math-mode .mq-denominator {\n    display: block;\n}\n\n.mq-math-mode .mq-numerator {\n    padding: 0 0.1em;\n}\n\n.mq-math-mode .mq-denominator {\n    border-top: 1px solid;\n    float: right;\n    width: 100%;\n    padding: 0.1em;\n}\n\n.mq-math-mode .mq-sqrt-prefix {\n    padding-top: 0;\n    position: relative;\n    top: 0.1em;\n    vertical-align: top;\n    -webkit-transform-origin: top;\n    -moz-transform-origin: top;\n    -ms-transform-origin: top;\n    -o-transform-origin: top;\n    transform-origin: top;\n}\n\n.mq-math-mode .mq-sqrt-stem {\n    border-top: 1px solid;\n    margin-top: 1px;\n    padding-left: .15em;\n    padding-right: .2em;\n    margin-right: .1em;\n    padding-top: 1px;\n}\n\n.mq-math-mode .mq-vector-prefix {\n    display: block;\n    text-align: center;\n    line-height: .25em;\n    margin-bottom: -0.1em;\n    font-size: 0.75em;\n}\n\n.mq-math-mode .mq-vector-stem {\n    display: block;\n}\n\n.mq-math-mode .mq-large-operator {\n    text-align: center;\n}\n\n.mq-math-mode .mq-large-operator .mq-from,\n.mq-math-mode .mq-large-operator big,\n.mq-math-mode .mq-large-operator .mq-to {\n    display: block;\n}\n\n.mq-math-mode .mq-large-operator .mq-from,\n.mq-math-mode .mq-large-operator .mq-to {\n    font-size: 80%;\n}\n\n.mq-math-mode .mq-large-operator .mq-from {\n    float: right;\n    /* take out of normal flow to manipulate baseline */\n    width: 100%;\n}\n\n.mq-math-mode,\n.mq-math-mode .mq-editable-field {\n    cursor: text;\n    font-family: Symbola, "Times New Roman", serif;\n}\n\n.mq-math-mode .mq-overarrow {\n    border-top: 1px solid black;\n    margin-top: 1px;\n    padding-top: 0.2em;\n}\n\n.mq-math-mode .mq-overarrow:before {\n    display: block;\n    position: relative;\n    top: -0.34em;\n    font-size: 0.5em;\n    line-height: 0em;\n    content: '\\27A4';\n    text-align: right;\n}\n\n.mq-math-mode .mq-overarrow.mq-arrow-left:before {\n    -moz-transform: scaleX(-1);\n    -o-transform: scaleX(-1);\n    -webkit-transform: scaleX(-1);\n    transform: scaleX(-1);\n    filter: FlipH;\n    -ms-filter: "FlipH";\n}\n\n.mq-math-mode .mq-selection,\n.mq-editable-field .mq-selection,\n.mq-math-mode .mq-selection .mq-non-leaf,\n.mq-editable-field .mq-selection .mq-non-leaf,\n.mq-math-mode .mq-selection .mq-scaled,\n.mq-editable-field .mq-selection .mq-scaled {\n    background: #B4D5FE !important;\n    background: Highlight !important;\n    color: HighlightText;\n    border-color: HighlightText;\n}\n\n.mq-math-mode .mq-selection .mq-matrixed,\n.mq-editable-field .mq-selection .mq-matrixed {\n    background: #39F !important;\n}\n\n.mq-math-mode .mq-selection .mq-matrixed-container,\n.mq-editable-field .mq-selection .mq-matrixed-container {\n    filter: progid:DXImageTransform.Microsoft.Chroma(color='#3399FF') !important;\n}\n\n.mq-math-mode .mq-selection.mq-blur,\n.mq-editable-field .mq-selection.mq-blur,\n.mq-math-mode .mq-selection.mq-blur .mq-non-leaf,\n.mq-editable-field .mq-selection.mq-blur .mq-non-leaf,\n.mq-math-mode .mq-selection.mq-blur .mq-scaled,\n.mq-editable-field .mq-selection.mq-blur .mq-scaled,\n.mq-math-mode .mq-selection.mq-blur .mq-matrixed,\n.mq-editable-field .mq-selection.mq-blur .mq-matrixed {\n    background: #D4D4D4 !important;\n    color: black;\n    border-color: black;\n}\n\n.mq-math-mode .mq-selection.mq-blur .mq-matrixed-container,\n.mq-editable-field .mq-selection.mq-blur .mq-matrixed-container {\n    filter: progid:DXImageTransform.Microsoft.Chroma(color='#D4D4D4') !important;\n}\n\n.mq-editable-field .mq-textarea,\n.mq-math-mode .mq-textarea {\n    position: relative;\n    -webkit-user-select: text;\n    -moz-user-select: text;\n    user-select: text;\n}\n\n.mq-editable-field .mq-textarea *,\n.mq-math-mode .mq-textarea *,\n.mq-editable-field .mq-selectable,\n.mq-math-mode .mq-selectable {\n    -webkit-user-select: text;\n    -moz-user-select: text;\n    user-select: text;\n    position: absolute;\n    clip: rect(1em 1em 1em 1em);\n    -webkit-transform: scale(0);\n    -moz-transform: scale(0);\n    -ms-transform: scale(0);\n    -o-transform: scale(0);\n    transform: scale(0);\n    resize: none;\n    width: 1px;\n    height: 1px;\n}\n\n.mq-math-mode .mq-matrixed {\n    background: white;\n    display: -moz-inline-box;\n    display: inline-block;\n}\n\n.mq-math-mode .mq-matrixed-container {\n    filter: progid:DXImageTransform.Microsoft.Chroma(color='white');\n    margin-top: -0.1em;\n}`,""]);const v=u},82:(t,e,n)=>{n.d(e,{A:()=>s});var i=n(601),o=n.n(i),a=n(314),r=n.n(a)()(o());r.push([t.id,"/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}",""]);const s=r},16:(t,e,n)=>{n.d(e,{A:()=>s});var i=n(601),o=n.n(i),a=n(314),r=n.n(a)()(o());r.push([t.id,"* {\n    box-sizing: border-box;\n    position: relative;\n}\n\nbody {\n    font-family: Arial, sans-serif;\n    overflow: hidden;\n}\n\n/* --- */\n.freemath-container {\n    cursor: grab;\n}\n\n.freemath-container.dragging {\n    cursor: grabbing;\n}\n\n.freemath-canvas {\n}\n\n.freemath-path-container {\n}\n\n.freemath-note-container {\n}\n\n.note {\n    position: absolute;\n    display: block;\n    white-space: nowrap;\n    margin: 0;\n    padding: 8px;\n    border: 1px solid #888;\n    background-color: white;\n    border-radius: 6px;\n    cursor: move;\n    transform: translate(-50%, -50%);\n}\n\n.freemath-container.drawingPath .note:after {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n/*    background-color: rgba(250, 250, 250, 0.6);*/\n}\n\n.note.focus {\n    box-shadow: 0 0 6px #fdfa72, 0 0 6px #fdfa72;\n}\n\n/* --- */\n\n@keyframes path-blink {\n    0% {\n        stroke-width: 4px;\n    }\n    50% {\n        stroke-width: 2px;\n    }\n    100% {\n        stroke-width: 4px;\n    }\n}\n\n.path {\n    stroke: #ccc;\n    stroke-width: 2;\n    cursor: pointer;\n}\n\n.path.focus {\n    stroke: #e3e166;\n    stroke-width: 4px;\n}\n\n/* --- dark mode --- */\n\n.freemath-container.dark.drawingPath .note:after {\n/*    background-color: rgba(100, 100, 100, 0.6);*/\n}\n\n.freemath-container.dark .note,\n.freemath-container.dark .mathnote-text-textarea{\n    background-color: #222;\n    color: #eee;\n}\n\n.freemath-container.dark .mq-latex-command-input {\n    border-color: #eee;\n}\n\n.freemath-container.dark .mq-cursor {\n    border-color: #eee;\n}\n\n.freemath-container.dark .mq-denominator.mq-empty,\n.freemath-container.dark .mq-numerator.mq-empty,\n.freemath-container.dark .mq-from .mq-empty,\n.freemath-container.dark .mq-to .mq-empty {\n    background-color: #555;\n}\n\n.freemath-container.dark .mq-editable-field.mq-focused,\n.freemath-container.dark .mq-math-mode .mq-editable-field.mq-focused {\n    -webkit-box-shadow: #0278c7 0 0 1px 1px, inset #002b57 0 0 1px 0;\n    -moz-box-shadow: #0278c7 0 0 1px 1px, inset #002b57 0 0 1px 0;\n    box-shadow: #0278c7 0 0 1px 1px, inset #002b57 0 0 1px 0;\n    border-color: #0063bd;\n    border-radius: 1px;\n}\n\n.freemath-container.dark .note.focus {\n    box-shadow: 0 0 6px #e3e166, 0 0 6px #e3e166;\n}\n\n\n.freemath-container.dark .path {\n    stroke: #999;\n}\n\n\n.freemath-container.dark .mq-math-mode .mq-selection,\n.freemath-container.dark .mq-editable-field .mq-selection,\n.freemath-container.dark .mq-math-mode .mq-selection .mq-non-leaf,\n.freemath-container.dark .mq-editable-field .mq-selection .mq-non-leaf,\n.freemath-container.dark .mq-math-mode .mq-selection .mq-scaled,\n.freemath-container.dark .mq-editable-field .mq-selection .mq-scaled {\n    background: #6190c9 !important;\n    color: white;\n}\n\n\n/* --- */\n\n@media print {\n    * {\n        -webkit-print-color-adjust: exact ;\n        color-adjust: exact ;\n    }\n}\n\n\n\n\n\n\n\n",""]);const s=r},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,o,a){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var s=0;s<this.length;s++){var m=this[s][0];null!=m&&(r[m]=!0)}for(var d=0;d<t.length;d++){var l=[].concat(t[d]);i&&r[l[0]]||(void 0!==a&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=a),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),o&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=o):l[4]="".concat(o)),e.push(l))}},e}},417:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},601:t=>{t.exports=function(t){return t[1]}},72:t=>{var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var a={},r=[],s=0;s<t.length;s++){var m=t[s],d=i.base?m[0]+i.base:m[0],l=a[d]||0,h="".concat(d," ").concat(l);a[d]=l+1;var c=n(h),p={css:m[1],media:m[2],sourceMap:m[3],supports:m[4],layer:m[5]};if(-1!==c)e[c].references++,e[c].updater(p);else{var f=o(p,i);i.byIndex=s,e.splice(s,0,{identifier:h,updater:f,references:1})}r.push(h)}return r}function o(t,e){var n=e.domAPI(e);n.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var a=i(t=t||[],o=o||{});return function(t){t=t||[];for(var r=0;r<a.length;r++){var s=n(a[r]);e[s].references--}for(var m=i(t,o),d=0;d<a.length;d++){var l=n(a[d]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}a=m}}},659:t=>{var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},361:(t,e,n)=>{t.exports=n.p+"font/Latin-Modern-Roman-10.otf"},989:(t,e,n)=>{t.exports=n.p+"font/Symbola.eot"},316:(t,e,n)=>{t.exports=n.p+"font/Symbola.otf"},999:(t,e,n)=>{t.exports=n.p+"font/Symbola.svg"},599:(t,e,n)=>{t.exports=n.p+"font/Symbola.ttf"},45:(t,e,n)=>{t.exports=n.p+"font/Symbola.woff"},349:(t,e,n)=>{t.exports=n.p+"font/Symbola.woff2"},445:(t,e,n)=>{t.exports=n.p+"font/edukai-5.0.woff"},653:(t,e,n)=>{t.exports=n.p+"font/edukai-5.0.woff2"}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={id:i,exports:{}};return t[i](a,a.exports,n),a.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var o=i.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=i[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t+"../"})(),n.b=document.baseURI||self.location.href,n.nc=void 0;var i=n(72),o=n.n(i),a=n(825),r=n.n(a),s=n(659),m=n.n(s),d=n(56),l=n.n(d),h=n(540),c=n.n(h),p=n(113),f=n.n(p),u=n(82),g={};g.styleTagTransform=f(),g.setAttributes=l(),g.insert=m().bind(null,"head"),g.domAPI=r(),g.insertStyleElement=c();o()(u.A,g);u.A&&u.A.locals&&u.A.locals;var b=n(699),q={};q.styleTagTransform=f(),q.setAttributes=l(),q.insert=m().bind(null,"head"),q.domAPI=r(),q.insertStyleElement=c();o()(b.A,q);b.A&&b.A.locals&&b.A.locals;var y=n(16),x={};x.styleTagTransform=f(),x.setAttributes=l(),x.insert=m().bind(null,"head"),x.domAPI=r(),x.insertStyleElement=c();o()(y.A,x);y.A&&y.A.locals&&y.A.locals;var w=n(710),v={};v.styleTagTransform=f(),v.setAttributes=l(),v.insert=m().bind(null,"head"),v.domAPI=r(),v.insertStyleElement=c();o()(w.A,v);w.A&&w.A.locals&&w.A.locals;const k=class{constructor(t={}){this.id=t.id||this.hash(Date.now().toString()),this.dom={},this.dom.parent=t.parent||document.body,this.mathquill=MathQuill.getInterface(2),this.createTime=this.getTime(),this.id_prefix=this.config?.id_prefix||this.id,this._id_num=1,this.focusId=null,this.mathfields={},this.states={},this.isComposing=!1,window.MathEditors?window.MathEditors.forEach((t=>{Object.values(t.mathfields).forEach((t=>{t.blur()}))})):window.MathEditors=[],window.MathEditors.push(this),window.needFocusUpDown=!1,this.initializeDom(),t.states&&this.loadStates(t.states,t.order)}createId(t){return this._id_num+=1,`${this.id_prefix}-${this._id_num-1}`}initializeDom(){this.dom.container=this.createAndAppendElement(this.dom.parent,"div",{class:"mathnote-container",id:this.id}),this.dom.matheqs={},this.dom.labels={},this.createEquationDom()}loadStates(t,e=null){this.mathfields={},this.dom.container.innerHTML="";const n=t=>{const e=t.id,n=parseInt(e.split("-").pop());n>=this._id_num&&(this._id_num=n+1);const{matheq:i,mathfield:o}=this.addMathModeArea(t);this.dom.container.appendChild(i),this.states[e]=t,t.latex?o.latex(t.latex):t.text&&this.addTextModeArea(i,o,t)};e?e.forEach((e=>{n(t[e])})):Object.values(t).forEach((t=>{n(t)})),this.orderLabelNum()}createEquationDom(){const t=this.createId(),e={id:t,isEmpty:!0,latex:""},{matheq:n,mathfield:i}=this.addMathModeArea(e);return this.dom.container.lastChild&&this.dom.matheqs[this.focusId]&&this.dom.matheqs[this.focusId].nextSibling?this.dom.matheqs[this.focusId].nextSibling&&this.dom.container.insertBefore(n,this.dom.matheqs[this.focusId].nextSibling):this.dom.container.appendChild(n),this.orderLabelNum(),this.states[t]=e,this.focusId=t,i.focus(),!0}createLabelDom(t){const e=`${t}-label-num`,n=this.createAndAppendElement(null,"div",{class:"mathnote-label"}),i=this.createAndAppendElement(n,"span",{class:"mq-non-leaf"});this.createAndAppendElement(i,"span",{class:"mq-scaled mq-paren",style:"transform: scale(0.999983, 1.1999)",textContent:"("}),this.createAndAppendElement(i,"span",{class:"mq-non-leaf matheq-label-num",id:e,textContent:"0"}),this.createAndAppendElement(i,"span",{class:"mq-scaled mq-paren",style:"transform: scale(0.999983, 1.1999)",textContent:")"});return this.dom.labels[e]=n.querySelector(`#${e}`),n}orderLabelNum(){requestAnimationFrame(function(){Array.from(this.dom.container.querySelectorAll(".matheq-label-num")).forEach(((t,e)=>{t.textContent=`${e+1}`}))}.bind(this))}addMathModeArea(t){const e=t.id,n=this.createAndAppendElement(null,"div",{class:"mathnote-matheq",id:e}),i=this.createLabelDom(e),o=this.createAndAppendElement(null,"textarea",{class:"mathnote-math-textarea",autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:"false",id:`${e}-mathmode-textarea`});o.setAttribute("x-palm-disable-ste-all","true");const a=this.mathquill.MathField(n,{substituteTextarea:function(){return o},handlers:{edit:function(e){t.latex=a.latex(),t.isEmpty=""===t.latex},enter:function(){this.createEquationDom()}.bind(this)}});return n.appendChild(i),o.addEventListener("keydown",function(t){this.handleMathKeydown(t,n,a)}.bind(this),!1),n.addEventListener("click",function(t){this.focusId=e}.bind(this),!1),this.dom.matheqs[e]=n,this.mathfields[e]=a,{matheq:n,mathfield:a}}addTextModeArea(t,e,n){const i=t.id,o=this.states[i]||n;if(!o)return;const a=this.createAndAppendElement(null,"div",{class:"mathnote-matheq textmode",id:i});t.replaceWith(a);const r=this.createAndAppendElement(a,"div",{class:"mathnote-text-container"}),s=this.createAndAppendElement(r,"textarea",{class:"mathnote-text-textarea",autocapitalize:"off",id:`${i}-textmode-textarea`,rows:1,value:o.text||""}),m=()=>{o.text=s.value,o.isEmpty=""===o.text,s.style.height="auto",s.style.width="auto",s.style.height=s.scrollHeight+"px",s.style.width=s.scrollWidth+"px"};setTimeout(m,100),s.addEventListener("keydown",function(t){this.handleTextKeydown(t,s,a)}.bind(this),!1),s.addEventListener("focus",function(t){a.classList.add("focus")}.bind(this),!1),s.addEventListener("blur",function(t){a.classList.remove("focus")}.bind(this),!1),s.addEventListener("compositionstart",function(){this.isComposing=!0}.bind(this),!1),s.addEventListener("compositionend",function(){this.isComposing=!1}.bind(this),!1),s.addEventListener("input",m.bind(this),!1),e.blur(),e=null,s.focus(),setTimeout((function(){o.text||(s.value="",o.text=s.value,o.isEmpty=!0)}),0),this.orderLabelNum(),this.dom.matheqs[i]=a,this.mathfields[i]=s,delete o.latex}handleMathKeydown(t,e,n){const i=this.states[this.focusId];"ArrowUp"===t.key||"ArrowDown"===t.key?setTimeout(function(){window.needFocusUpDown&&(window.needFocusUpDown=!1,this.moveFocusUpDown(t,e))}.bind(this),0):!i.isEmpty||"Backspace"!==t.key||t.shiftKey||t.ctrlKey||t.altKey||t.metaKey?i.isEmpty&&(t.ctrlKey||t.metaKey)&&"/"===t.key&&this.addTextModeArea(e,n):this.deleteFocus()}handleTextKeydown(t,e,n){const i=this.states[this.focusId];if(!this.isComposing)if("ArrowUp"===t.key||"ArrowDown"===t.key){const i=e.selectionStart,o=i>0,a=i<e.value.length;("ArrowUp"!==t.key||o)&&("ArrowDown"!==t.key||a)||this.moveFocusUpDown(t,n)}else if("Enter"!==t.key||t.shiftKey||t.ctrlKey||t.altKey||t.metaKey)if(!i.isEmpty||"Backspace"!==t.key||t.shiftKey||t.ctrlKey||t.altKey||t.metaKey){if(i.isEmpty&&(t.ctrlKey||t.metaKey)&&"/"===t.key){const t=this.focusId,e=this.states[t],{matheq:i,mathfield:o}=this.addMathModeArea(e);n.replaceWith(i),this.orderLabelNum(),o.focus(),delete e.text}}else this.deleteFocus();else t.preventDefault(),this.createEquationDom()}deleteFocus(){const t=this.focusId,e=this.dom.matheqs[t]?.previousSibling;if(!e)return;this.dom.matheqs[t].remove();const n=e.id;this.focusId=n,delete this.dom.matheqs[t],delete this.states[t],delete this.mathfields[t],this.mathfields[n].focus()}moveFocusUpDown(t,e){if("ArrowDown"===t.key&&e.nextSibling){const t=e.nextSibling.id;this.mathfields[t]?.focus(),this.focusId=t}else if("ArrowUp"===t.key&&e.previousSibling){const t=e.previousSibling.id;this.mathfields[t]?.focus(),this.focusId=t}}getTime(){const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}:${String(t.getMilliseconds()).padStart(2,"0")}`}hash(t){let e=0;for(let n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e|=0}e=Math.abs(e);let n="";for(;e>0;){n="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[(e+Math.floor(100*Math.random()))%26]+n,e=Math.floor(e/26)}return n}createAndAppendElement(t,e,n={}){const i=document.createElement(e);return n.class&&(n.class.split(" ").forEach((t=>i.classList.add(t))),delete n.class),n.dataset&&(Object.keys(n.dataset).forEach((t=>i.dataset[t]=n.dataset[t])),delete n.dataset),Object.keys(n).forEach((t=>i[t]=n[t])),t&&t.appendChild(i),i}};const S=class{constructor(t={}){this.dom={},this.translate={x:0,y:0},this._background={type:"dot",size:20,lineStyle:"#aaa",lineWidth:1,color:"white"},this.background=Object.assign({},this._background),this.createTime=this.getTime(),this.dom.parent=t.parent||document.body,this.mouseClickStart={x:0,y:0},this.isDraggingCanvas=!1,this.draggingCanvasStart={x:0,y:0},this.currentDraggingNote=null,this.focusNote=null,this.drawingPath=!1,this.pathStart={x:0,y:0,id:null},this.initializeDom(),this.windowSize={x:window.innerWidth,y:window.innerHeight};const e=window.localStorage.getItem("isDarkMode");this.isDarkMode=`${e}`?"true"===e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,this.isUserToggleDarkLightMode=!!`${e}`&&"true"===e}initializeDom(){this.dom.container=this.createAndAppendElement(this.dom.parent,"div",{class:"freemath-container",style:"display: block; position: fixed; top: 0; left: 0; overflow: hidden; width: 100vw; height: 100vh;"}),this.dom.canvas=this.createAndAppendElement(this.dom.container,"div",{class:"freemath-canvas",style:"display: block; position: fixed;  overflow: hidden; width: 100%; height: 100%;"}),this.dom.noteContainer=this.createAndAppendElement(this.dom.container,"div",{class:"freemath-note-container",style:"display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%;"}),this.dom.favicon=document.querySelector("#favicon"),this.dom.notes={},this.dom.paths={},this.changeBackground(),this.initializeSVGLayer(),setTimeout((()=>{this.changeDarkLightModeEvent()}),0),this.dom.container.addEventListener("wheel",this.containerWheelEvents.bind(this),{passive:!0}),this.dom.container.addEventListener("dblclick",this.containerDoubleClickEvent.bind(this),!1),this.dom.container.addEventListener("mousedown",this.containerMouseDownEvent.bind(this),!1),this.dom.container.addEventListener("dragenter",this.preventDefaults,!1),this.dom.container.addEventListener("dragover",this.preventDefaults,!1),this.dom.container.addEventListener("drop",this.containerDropEvent.bind(this),!1),window.addEventListener("resize",this.windowResizeEvent.bind(this),!1),document.addEventListener("keydown",this.containerKeyDownEvent.bind(this),!1),document.addEventListener("keyup",this.containerKeyUpEvent.bind(this),!1),document.addEventListener("mousemove",this.containerMouseMoveEvent.bind(this),!1),document.addEventListener("mouseup",this.containerMouseUpEvent.bind(this),!1),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",this.changeDarkLightModeEvent.bind(this),!1),window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").addEventListener("change",this.changeDarkLightModeEvent.bind(this),!1)}initializeSVGLayer(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("overflow","visible"),t.style="display: block; width: 100%; height: 100%; position: absolute; left: 0; top: 0;",this.dom.pathContainer=t,this.dom.canvas.appendChild(t),this.dom.noteContainer.appendChild(t)}changeDarkLightModeEvent(t){this.isUserToggleDarkLightMode&&!t||(this.isDarkMode=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches),this.isDarkMode?(this.dom.favicon.href="./img/freemath.dark.png",this.background.lineStyle="#888",this.background.color="#333",this.changeBackground(),this.dom.container.classList.add("dark")):(this.dom.favicon.href="./img/freemath.light.png",this.background.lineStyle=this._background.lineStyle,this.background.color=this._background.color,this.changeBackground(),this.dom.container.classList.remove("dark"))}preventDefaults(t){t.preventDefault(),t.stopPropagation()}windowResizeEvent(t){const e=this.windowSize;this.translate.x+=.5*(window.innerWidth-e.x),this.translate.y+=.5*(window.innerHeight-e.y),this.moveToTranslation(),this.windowSize={x:window.innerWidth,y:window.innerHeight}}containerDropEvent(t){this.preventDefaults(t);const e=t.dataTransfer.files;if(e.length>0){const t=e[0],n=new FileReader;n.onload=t=>{const e=t.target.result;try{const t=JSON.parse(e);this.loadState(t)}catch(t){console.error(t)}},n.readAsText(t)}}loadState(t){Object.values(this.dom.notes).forEach((t=>{t.remove()})),window.MathEditors=[],this.dom.notes={},this.isDarkMode=t.isDarkMode,this.createTime=t.createTime,this.background=t.background,this.isUserToggleDarkLightMode=t.isUserToggleDarkLightMode,this.smoothMoveTo(t.translate);const e={};t.matheditors.forEach((t=>{e[t.id]=t,this.addNote(t.center.x,t.center.y,t.id,t.createTime,t.matheditor,t.order)})),t.linkpaths.forEach((t=>{const n=t[0],i=t[1];if(!n||!i)return;const o=e[n],a=e[i];this.createBezierCurve(o.center,a.center)}))}containerWheelEvents(t){t.ctrlKey||(this.translate.x-=t.deltaX,this.translate.y-=t.deltaY,this.moveToTranslation())}moveToTranslation(){const t=this.dom.container.getBoundingClientRect(),e=.5*t.width,n=.5*t.height;requestAnimationFrame(function(){this.dom.noteContainer.style.transform=`translate(${this.translate.x}px, ${this.translate.y}px)`,this.dom.canvas.style.backgroundPosition=`${e+this.translate.x}px ${n+this.translate.y}px`}.bind(this))}smoothMoveTo(t,e=500){return new Promise((n=>{const i=this.translate.x,o=this.translate.y,a=performance.now(),r=s=>{const m=s-a,d=Math.min(m/e,1),l=(h=d)<.5?4*h*h*h:1-Math.pow(-2*h+2,3)/2;var h;this.translate.x=i+(t.x-i)*l,this.translate.y=o+(t.y-o)*l;const c=this.dom.container.getBoundingClientRect(),p=.5*c.width,f=.5*c.height;this.dom.noteContainer.style.transform=`translate(${this.translate.x}px, ${this.translate.y}px)`,this.dom.canvas.style.backgroundPosition=`${p+this.translate.x}px ${f+this.translate.y}px`,d<1?requestAnimationFrame(r):n()};requestAnimationFrame(r)}))}containerDoubleClickEvent(t){t.preventDefault(),app.addNote(t.clientX-this.translate.x,t.clientY-this.translate.y)}containerMouseDownEvent(t){Object.values(this.dom.notes).forEach((t=>{t.classList.remove("focus")})),Object.values(this.dom.paths).forEach((t=>{t.dom.classList.remove("focus")}));const e=t.target.classList;if(!e.contains("note")&&!e.contains("path"))return this.focusNote=null,this.isDraggingCanvas=!0,this.draggingCanvasStart.x=t.clientX,this.draggingCanvasStart.y=t.clientY,void this.dom.container.classList.add("dragging");if(this.focusNote=t.target,this.focusNote.classList.add("focus"),!t.shiftKey||this.drawingPath||this.dom.drawingPath)this.currentDraggingNote=t.target,this.startX=t.clientX-t.target.offsetLeft,this.startY=t.clientY-t.target.offsetTop;else{this.drawingPath=!0;const e=t.target.getBoundingClientRect(),n={x:e.left+.5*e.width-this.translate.x,y:e.top+.5*e.height-this.translate.y,id:t.target.id};this.dom.drawingPath=this.createBezierCurve(n,n),this.pathStart=n}}containerMouseMoveEvent(t){if(!t.shiftKey&&this.currentDraggingNote){const e=this.dom.noteContainer.getBoundingClientRect(),n=t.clientX-e.left-this.startX+this.translate.x,i=t.clientY-e.top-this.startY+this.translate.y;this.currentDraggingNote.style.left=`${n}px`,this.currentDraggingNote.style.top=`${i}px`;const o=this.currentDraggingNote.id;Object.keys(this.dom.paths).forEach((t=>{if(!t.includes(o))return;const e=this.dom.paths[t],n=this.currentDraggingNote.getBoundingClientRect(),i=n.left+.5*n.width-this.translate.x,a=n.top+.5*n.height-this.translate.y;o===e.start.id?(e.start.x=i,e.start.y=a):o===e.end.id&&(e.end.x=i,e.end.y=a),this.setBezierCurvePath(e.dom,e.start,e.end)}))}else if(t.shiftKey&&this.drawingPath&&this.dom.drawingPath){const e={x:t.clientX-this.translate.x,y:t.clientY-this.translate.y};this.setBezierCurvePath(this.dom.drawingPath,this.pathStart,e,this.pathStart.width,this.pathStart.width)}else if(this.isDraggingCanvas){const e=t.clientX-this.draggingCanvasStart.x,n=t.clientY-this.draggingCanvasStart.y;this.translate.x+=e,this.translate.y+=n,this.moveToTranslation(),this.draggingCanvasStart.x=t.clientX,this.draggingCanvasStart.y=t.clientY}}containerMouseUpEvent(t){if(this.isDraggingCanvas=!1,this.dom.container.classList.remove("dragging"),this.currentDraggingNote)this.currentDraggingNote=null;else if(this.drawingPath&&this.dom.drawingPath&&(this.dom.drawingPath.remove(),t.target.classList.contains("note"))){const e=t.target.id;if(this.pathStart.id===e)return;const n=`${this.pathStart.id}-${e}`;if(Object.keys(this.dom.paths).includes(n))return;const i=t.target.getBoundingClientRect(),o={x:i.left+.5*i.width-this.translate.x,y:i.top+.5*i.height-this.translate.y,id:e};this.dom.paths[n]={start:this.pathStart,end:o,dom:this.createBezierCurve(this.pathStart,o)}}this.dom.drawingPath=null,this.drawingPath=!1}containerKeyDownEvent(t){if(t.shiftKey&&!document.querySelector(".mq-focused")&&this.dom.container.classList.add("drawingPath"),this.focusNote&&"Backspace"===t.key){const t=this.focusNote.classList.contains("note")?"note":"path";if(!window.confirm(`Are you sure to delete this ${t}?`))return;const e=this.focusNote.id;this.focusNote.remove(),Object.keys(this.dom.paths).forEach((t=>{t.includes(e)&&this.dom.paths[t].dom.remove()})),window.MathEditors=window.MathEditors.filter((t=>t.id!==e))}else if(t.metaKey||t.ctrlKey)if("e"===t.key){t.preventDefault();const e=`freemath-${this.createTime}.json`;this.exportState(e)}else if("s"===t.key){t.preventDefault();const e=this.getState();console.log(e)}else"f"===t.key?(t.preventDefault(),this.toggleFullScreen()):"b"===t.key?(this.isUserToggleDarkLightMode||(this.isUserToggleDarkLightMode=!0),this.isDarkMode=!this.isDarkMode,this.changeDarkLightModeEvent(),window.localStorage.setItem("isDarkMode",this.isDarkMode)):t.altKey?["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9"].includes(t.code)&&this.centerNote(parseInt(t.code.replace("Digit",""))):"p"===t.key&&(t.preventDefault(),this.printInfiniteCanvas())}containerKeyUpEvent(){this.dom.container.classList.remove("drawingPath")}toggleFullScreen(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}centerNote(t){if(!window.MathEditors||t>window.MathEditors.length)return;const e=window.MathEditors[t-1];if(!e)return;const n=e.id;if(!n)return;const i=document.querySelector(`#${n}`);if(!i)return;const o=i.getBoundingClientRect(),a=o.left+.5*o.width,r=o.top+.5*o.height,s={x:this.translate.x+.5*window.innerWidth-a,y:this.translate.y+.5*window.innerHeight-r};this.smoothMoveTo(s,200);const m=window.MathEditors.find((t=>t.id===n));if(!m)return;const d=Object.values(m.mathfields),l=d[d.length-1];l.focus()}getState(){if(!window.MathEditors)return;const t={translate:this.translate,isDarkMode:this.isDarkMode,isUserToggleDarkLightMode:this.isUserToggleDarkLightMode,createTime:this.createTime,background:this.background,matheditors:[],linkpaths:[]};return window.MathEditors.forEach((e=>{const n=e.id,i=this.dom.noteContainer.querySelector(`#${n}`);if(!i)return;const o=Array.from(i.querySelectorAll("div")).filter((t=>t.id.includes(`${n}-`))).map((t=>t.id)),a=parseFloat(i.style.left.replace("px","")),r=parseFloat(i.style.top.replace("px","")),s={id:n,matheditor:e.states,order:o,center:{x:a,y:r},createTime:i.getAttribute("data-create-time")};t.matheditors.push(s)})),Object.keys(this.dom.paths).forEach((e=>{t.linkpaths.push(e.split("-"))})),t}exportState(t){const e=this.getState(),n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,4)),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",t),document.body.appendChild(i),i.click(),i.remove()}createBezierCurve(t,e,n=null,i=null){const o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.classList.add("path"),o.setAttribute("fill","none"),this.setBezierCurvePath(o,t,e,n,i),this.dom.pathContainer.appendChild(o),o}setBezierCurvePath(t,e,n,i=null,o=null){const a=e.x,r=e.y,s=n.x,m=n.y,d=a+.7*(s-a),l=r,h=s-.7*(s-a),c=m;t.setAttribute("d",`M ${a} ${r} C ${d} ${l}, ${h} ${c}, ${s} ${m}`)}findParentWithSelector(t,e){if(!t)return null;let n=t;for(;n;){if(n===document.body)return null;if(n.matches(e))return n;n=n.parentElement}return null}addNote(t,e,n=null,i=null,o=null,a=null){n=n||this.hash(`${t}-${e}-${Date.now()}`.padStart(50,"0")).slice(0,10);const r=this.createAndAppendElement(this.dom.noteContainer,"div",{class:"note",id:n,draggable:!1,style:`display: block; absolute; top: ${e}px; left: ${t}px; min-width: 300px;`,dataset:{createTime:i||this.getTime()}});new k({parent:r,id:n,states:o,order:a});this.dom.notes[n]=r}changeBackground(){const t=this.dom.canvas,e=this.background;if("none"===e.type)return t.style.backgroundColor=e.color,void(t.style.backgroundImage="none");const n=this.dom.container.getBoundingClientRect(),i=.5*n.width,o=.5*n.height;t.style.background=e.color,"dot"===e.type?t.style.backgroundImage=`radial-gradient(${e.lineStyle} ${e.lineWidth}px, transparent 0)`:"grid"===e.type&&(t.style.backgroundImage=`linear-gradient(to right, ${e.lineStyle} ${e.lineWidth}px, transparent ${e.lineWidth}px), linear-gradient(to bottom, ${e.lineStyle} ${e.lineWidth}px, transparent ${e.lineWidth}px)`),t.style.backgroundPosition=`${i+this.translate.x}px ${o+this.translate.y}px`,t.style.backgroundSize=`${e.size}px ${e.size}px`}getTime(){const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}.${String(t.getMinutes()).padStart(2,"0")}.${String(t.getSeconds()).padStart(2,"0")}.${String(t.getMilliseconds()).padStart(2,"0")}`}hash(t){let e=0;for(let n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e|=0}e=Math.abs(e);const n="ABCDEFGHIJKLMNOPQRSTUVWXYZ";let i="";for(;e>0;){i=n[(e+Math.floor(1e3*Math.random()))%26]+i,e=Math.floor(e/26*10)}return i}createAndAppendElement(t,e,n={}){const i=document.createElement(e);return n.class&&(n.class.split(" ").forEach((t=>i.classList.add(t))),delete n.class),n.dataset&&(Object.keys(n.dataset).forEach((t=>i.dataset[t]=n.dataset[t])),delete n.dataset),Object.keys(n).forEach((t=>{i[t]=n[t],i[t]||i.setAttribute(t,n[t])})),Object.keys(n).forEach((t=>{i[t]=n[t]})),t&&t.appendChild(i),i}addStyle(t){const e=document.createElement("style");e.type="text/css",e.media="print",e.innerText=t,document.head.appendChild(e)}printInfiniteCanvas(){const t={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0},e={x:this.translate.x,y:this.translate.y},n=`${this.background.type}`;this.background.type="none",this.changeBackground(),Object.values(this.dom.notes).forEach((e=>{const n=e.getBoundingClientRect(),i=n.x,o=n.y,a=n.x+n.width,r=n.y+n.height;i<t.xmin&&(t.xmin=i),o<t.ymin&&(t.ymin=o),a>t.xmax&&(t.xmax=a),r>t.ymax&&(t.ymax=r)})),this.smoothMoveTo({x:this.translate.x-t.xmin,y:this.translate.y-t.ymin},200).then((()=>{const i=t.xmax-t.xmin,o=t.ymax-t.ymin;this.addStyle(`@page {size: ${i}px ${o}px; margin: 0;}`),document.title=`Freemath-${this.getTime()}`;const a=()=>{this.smoothMoveTo(e,200),this.background.type=n,this.changeBackground(),window.removeEventListener("afterprint",a)};window.addEventListener("afterprint",a.bind(this),!1),window.print()}))}};window.addEventListener("load",(t=>{const e=new S({});e.addNote(.5*window.innerWidth,.5*window.innerHeight),window.app=e}))})();